<!DOCTYPE html>

<html>

<head>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>

</head>

<body>

    <script>

    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 800,
        backgroundColor: '#ffffff',
        physics: {
            default: 'arcade',
        },

        scene: {
            preload: preload,
            create: create,
            update: update,
        }

    };

    var game = new Phaser.Game(config);
    
    //Game Objects
    var level;
    var player;
    var collectibles = [];
    var objects = [];
    var maps = [];

    //inkMap[posY][posX]
    var inkMap = new Array(10);

    for (let i = 0; i < inkMap.length; i++) {
        inkMap[i] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    }

    //Keyboard controls
    var cursors;
    var space;
    var keyA, keyD, keyW, keyS;

    var graphics;

    function preload()
    {
        this.load.image('inkBlob', 'inkblob/ink blob.png');
        //this.load.atlas('seacreatures', 'assets/seacreatures_json.png', 'assets/seacreatures_json.json');
    }

    function create()
    {
        //Set the background origin to be at (0, 0) or top left corner of the image rather than the center of the image asset

       //create all animations
       //this.anims.create({key: 'inkBlob', frames: this.anims.generateFrameNames('seacreatures', {prefix: 'blueJellyfish', end: 32, zeroPad: 4}), repeat: -1});

       //Create the platforms and the player character set to collide with the platforms
       //createPlatforms(this);
        createMap(0);

       //player = new Player(this, 400, 400, 'slime', playerAnimations);
        player = new Player(this, 0, 0, 'inkBlob', null);
        inkMap[0][0] = 1;
       //player.play(player.animations['idle']);

       //Set up user input
       cursors = this.input.keyboard.createCursorKeys();
       keyA = this.input.keyboard.addKey('A');
        keyD = this.input.keyboard.addKey('D');
        keyW = this.input.keyboard.addKey('W');
        keyS = this.input.keyboard.addKey('S');
       space = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

       keyA.on('down', move);
        keyD.on('down', move);
        keyW.on('down', move);
        keyS.on('down', move);

       graphics = this.add.graphics();
       console.log("done with create")
    }
    //creates each level layout based on the level id
    function createMap(id) {

    }

    function update()
    {

    }
    function move () {
        //Handle player movements
        let prevX = player.posX;
        let prevY = player.posY;
        let moved = false;
        if (isValidPos(prevX-1, prevY) && keyA.isDown && !keyD.isDown && !keyW.isDown && !keyS.isDown) {
            player.x -= 80;
            player.posX -= 1;
            moved = true;
        } else if (isValidPos(prevX+1, prevY) && keyD.isDown && !keyW.isDown && !keyS.isDown) {
            player.x += 80;
            player.posX += 1;
            moved = true;
        } else if (isValidPos(prevX, prevY-1) && keyW.isDown && !keyS.isDown) {
            player.y -= 80;
            player.posY -= 1;
            moved = true;
        } else if (isValidPos(prevX, prevY+1) && keyS.isDown) {
            player.y += 80;
            player.posY += 1;
            moved = true;
        }
        if (moved) {
            console.log(player.inkLevel);
            if (inkMap[player.posY][player.posX] === 0) {
                player.inkLevel--;
                inkMap[prevY][prevX] = 1;
            } else if (inkMap[player.posY][player.posX] === 1 && inkMap[prevY][prevX] === 0) {
                inkMap[player.posY][player.posX] = 0;
                inkMap[prevY][prevX] = 1;
            }
        }
        console.log(toString(inkMap));
        update()
    }
    class Player extends Phaser.Physics.Arcade.Sprite
    {
        animations;
        inkLevel = 10;
        //posX is the 0 based index of the inkblob in the map
        //x is the pixel position on the screen
        posX = 0;
        posY = 0;
        constructor(scene, posX, posY, spritesheet, animations)
        {
            super(scene, posX * 80 + 40, posY * 80 + 40, spritesheet);
            this.animations = animations;
            scene.add.existing(this);
            this.setScale(0.6);
        }
    }
    function toString (inkMap) {
        var result = "";
        for (let i of inkMap) {
            result += "[" + i + "], \n";
        }
        return result;
    }
    function isValidPos (posX, posY) {
        return posX >= 0 && posX < 10 && posY >= 0 && posY < 10;
    }
    </script>

</body>

</html>